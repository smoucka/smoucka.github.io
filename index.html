<!DOCTYPE html>
<html>
  <head>
    <title>Yahoo Fantasy Viz</title>
  	<script type="text/javascript" src="d3.min.js"></script>
    <script type="text/javascript" src="jquery-2.1.0.min.js"></script>
    
    <style>
      p {
        font-size: 14px;
        font-family: sans-serif;
      }

      #selector {
        width: 120px;
        hiehgt: 25px;
        background: black;
      }

      #selector select {
        font-size: 14px; 
        color: white;
        background: black;
        border: 0px;
        -webkit-appearance: none;
      }

      .statLabels {
        fill: white;
        text-anchor: end;
        font: 14px sans-serif;
      }

      .teamLabels {
        text-anchor: end;
        font: 18px sans-serif;
      }

    </style>

  </head>
  <body>
    <p>Select a stat category:</p>
    <div id="selector"></div>
    <div id="graph"></div>
  	<script type="text/javascript">

  		// Team stats data set
  		var stats = [
  			{"FTs": "110/132", "name": "Great Scott!", "Ast": 117.0, "Stl": 39.0, "Rbs": 212.0, "3pt": 33.0, "FGs": "187/399", "FTP": 0.833, "Blk": 21.0, "TOs": 78.0, "FGP": 0.469, "Pts": 517.0},
  			{"FTs": "87/118", "name": "From Last to First", "Ast": 107.0, "Stl": 30.0, "Rbs": 215.0, "3pt": 31.0, "FGs": "177/419", "FTP": 0.737, "Blk": 30.0, "TOs": 88.0, "FGP": 0.422, "Pts": 472.0},
  			{"FTs": "119/151", "name": "Large McBigHuge", "Ast": 117.0, "Stl": 46.0, "Rbs": 176.0, "3pt": 22.0, "FGs": "178/393", "FTP": 0.788, "Blk": 18.0, "TOs": 88.0, "FGP": 0.453, "Pts": 497.0},
  			{"FTs": "115/164", "name": "K-Mac", "Ast": 156.0, "Stl": 30.0, "Rbs": 192.0, "3pt": 36.0, "FGs": "185/384", "FTP": 0.701, "Blk": 32.0, "TOs": 82.0, "FGP": 0.482, "Pts": 521.0},
  			{"FTs": "136/201", "name": "ZNS", "Ast": 152.0, "Stl": 74.0, "Rbs": 300.0, "3pt": 36.0, "FGs": "237/529", "FTP": 0.677, "Blk": 31.0, "TOs": 102.0, "FGP": 0.448, "Pts": 646.0},
  			{"FTs": "121/155", "name": "Paul's Team", "Ast": 79.0, "Stl": 38.0, "Rbs": 207.0, "3pt": 22.0, "FGs": "210/446", "FTP": 0.781, "Blk": 27.0, "TOs": 81.0, "FGP": 0.471, "Pts": 563.0},
  			{"FTs": "94/119", "name": "Carter", "Ast": 116.0, "Stl": 28.0, "Rbs": 202.0, "3pt": 40.0, "FGs": "178/387", "FTP": 0.79, "Blk": 18.0, "TOs": 95.0, "FGP": 0.46, "Pts": 490.0},
  			{"FTs": "105/128", "name": "Starvis Flocka Flame", "Ast": 113.0, "Stl": 29.0, "Rbs": 181.0, "3pt": 32.0, "FGs": "163/407", "FTP": 0.82, "Blk": 20.0, "TOs": 72.0, "FGP": 0.4, "Pts": 463.0}];

      var margin = {top: 50, right: 20, bottom: 50, left: 20},
          width = 800 - margin.left - margin.right,
          height = 600 - margin.top - margin.bottom,
          barPad = 3,
          leftPad = 230;

      // Create category list and dropdown menu
      // In future, use league resource and settings
      var categories = [["FGP", "Field Goal %"],
                        ["FTP", "Free Throw %"],
                        ["3pt", "Three Point FGs"],
                        ["Pts", "Points"],
                        ["Ast", "Assists"],
                        ["Rbs", "Rebounds"],
                        ["Stl", "Steals"],
                        ["Blk", "Blocks"],
                        ["TOs", "Turnovers"]];

      d3.select("#selector").append("select")
        .attr("id", "selectCat")
        .selectAll("option")
        .data(categories)
        .enter()
        .append("option")
        .attr("value", function(d) { return d[0]; })
        .text( function(d) {return d[1]; });
      
      var statCat = $("#selectCat").val();

      // Create x- and y-scale
      var xScale = d3.scale.linear()
        .domain([0, d3.max(stats, function(d) { return d[statCat]; })])
        .range([0, width - leftPad]);

      var yScale = d3.scale.ordinal()
        .domain(d3.range(stats.length))
        .rangeRoundBands([0, height], 0.05);

      // Create SVG space
  		var svgContainer = d3.select("#graph").append("svg")
  			.attr("width", width + margin.left + margin.right)
  			.attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      // bars is global
      function attachData() {
        stats.sort(function(a,b) {return b[statCat]-a[statCat]; });

        bars = svgContainer.selectAll("g.teamGroup")
          .data(stats)
      };
      
      function assignSort(durationInt) {
        stats.sort(function(a,b) {return b[statCat]-a[statCat]; });

        bars.each(function(d, i) {
          var sortedIndex = -1;
          for (var n = 0; n<stats.length ; n++) {
            if (stats[n].name === d.name)
              d.sortedIndex = n
          }
        })
        .transition()
        .duration(durationInt)
        .attr("transform", function(d, i) {
            console.log(d)
            console.log("translate(0," + yScale(d.sortedIndex) + ")")
            return "translate(0," + yScale(d.sortedIndex) + ")";
          })
      };

      attachData();

      bars.enter()
          .append("g")
          .attr("class", "teamGroup");

      bars.append("rect");

      bars.append("text")
          .attr("class", "teamLabels");

      bars.append("text")
          .attr("class", "statLabels");

      function sortGroups(durationInt) {
        bars.transition()
          .duration(durationInt)
          .attr("transform", function(d, i) {
            return "translate(0," + yScale(i) + ")";
          })
      };

      function drawBars(durationInt) {
        bars.select("rect")
          .transition()
          .duration(durationInt)
          .attr({
            width: function(d) { return xScale(d[statCat]); },
            height: yScale.rangeBand()
          })
          .attr("transform", "translate(" + leftPad + ",0)")
      };

      function teamNames(durationInt) {
        bars.select(".teamLabels")
        .text(function(d) { return d.name; })
        .transition()
        .duration(durationInt)
        .attr("transform", "translate(" + (leftPad - 10) + "," + (yScale.rangeBand() / 2) + ")")
      };

      function teamStats(durationInt) {
        bars.select(".statLabels")
          .text(function(d) { return d[statCat]; })
          .transition()
          .duration(durationInt)
          .attr("transform", function(d, i) {
            return "translate(" + (leftPad + xScale(d[statCat]) - 10) + "," + (yScale.rangeBand() / 2) + ")"; })
      };

      sortGroups(0);
      drawBars(0);
      teamNames(0);
      teamStats(0);

      d3.select("select")
        .on("change", function() {
            statCat = $("#selectCat").val();

            xScale.domain([0, d3.max(stats, function(d) { return d[statCat]; })]);

            assignSort(500);
            //sortGroups(500);
            drawBars(500);
            teamNames(500);
            teamStats(500);
            /*
            svgContainer.select(".statLabels")
            .selectAll("text")
            .text(function(d) { return d[statCat]; })
            .transition()
            .duration(500)
            .attr({
              x: function(d, i) {return xScale(i) + xScale.rangeBand() / 2;},
              y: function(d) {return height - yScale(d[statCat]) + 20;},
            });
            */
        });
								
  	</script>

  </body>
</html>